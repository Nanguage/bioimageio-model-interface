<docs lang="markdown">
The panel for upload the image file.
</docs>

<config lang="json">
{
    "name": "upload-panel",
    "type": "window",
    "tags": [],
    "ui": "",
    "version": "0.1.0",
    "cover": "",
    "description": "[TODO: describe this plugin with one sentence.]",
    "icon": "extension",
    "inputs": null,
    "outputs": null,
    "api_version": "0.1.8",
    "env": "",
    "permissions": [],
    "requirements": ["https://cdn.tailwindcss.com"],
    "dependencies": ["http://127.0.0.1:8000/viewer.imjoy.html"]
}
</config>

<script lang="javascript">
class ImJoyPlugin {
    async setup() {
        const viewer_plugin = await api.getPlugin('viewer')
        const fileInput = document.getElementById("file-input")
        const fileChosen = document.getElementById('file-chosen');

        fileInput.addEventListener("change", async () => {
            const file = fileInput.files[0]
            fileChosen.textContent = file.name
            if (!file) {
                await api.alert("No file selected")
                return
            }
            const reader = new FileReader()
            reader.onload = async function() {
                await api.log("viewer plugin loaded")
                const content = this.result
                await viewer_plugin.load_image_from_bytes(file.name, content)
            }
            reader.readAsArrayBuffer(file)
        })

        const urlInput = document.getElementById("url-input")
        const urlLoadButton = document.getElementById("url-load-button")
        urlLoadButton.addEventListener("click", async () => {
            const url = urlInput.value
            if (!url) {
                await api.alert("No URL provided")
                return
            }
            await viewer_plugin.load_image_from_url(url)
        })

    }

    async run(ctx) {}
}

api.export(new ImJoyPlugin())
</script>

<window lang="html">
<div class="m-1">
    <h1 class="text-3xl font-bold">
        Upload then view the image
    </h1> 

    <p class="mt-4">Load an PNG, JPG or TIFF file:</p>
    <div class="flex">
      <span id="file-chosen" class="w-1/2 px-4 py-2 border border-gray-300 rounded-l-md text-gray-500">No file selected.</span>
      <label for="file-input" class="py-2 px-3 bg-blue-500 text-white rounded-r-md cursor-pointer w-20 text-center">
        Browse
      </label>
      <input type="file" id="file-input" class="hidden" />
    </div>

    <p class="mt-4">Or load from an URL:</p>
    <div class="flex">
      <input type="text" class="w-1/2 px-4 py-2 border border-gray-300 rounded-l-md text-gray-500"
        placeholder="Target URL"
        id="url-input" />
      <button
        class="px-4 py-2 bg-blue-500 text-white rounded-r-md w-20"
        id="url-load-button">Load</button>
    </div>
 
</div>
</window>
