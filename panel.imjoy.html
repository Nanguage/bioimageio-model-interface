<docs lang="markdown">
The panel for upload the image file.
</docs>

<config lang="json">
{
    "name": "upload-panel",
    "type": "window",
    "tags": [],
    "ui": "",
    "version": "0.1.0",
    "cover": "",
    "description": "[TODO: describe this plugin with one sentence.]",
    "icon": "extension",
    "inputs": null,
    "outputs": null,
    "api_version": "0.1.8",
    "env": "",
    "permissions": [],
    "requirements": ["https://cdn.tailwindcss.com"],
    "dependencies": ["http://127.0.0.1:8000/viewer.imjoy.html"]
}
</config>

<script lang="javascript">
class ImJoyPlugin {
    async setup() {
        const fileInput = document.getElementById("file_input")
        fileInput.addEventListener("change", async () => {
            const file = fileInput.files[0]
            if (!file) {
                await api.alert("No file selected")
                return
            }
            const reader = new FileReader()
            reader.onload = async function() {
                const plugin = await api.getPlugin('viewer')
                await api.log("plugin loaded")
                const content = this.result
                await plugin.read_image_from_bytes(file.name, content)
            }
            reader.readAsArrayBuffer(file)
        })
    }

    async run(ctx) {}
}

api.export(new ImJoyPlugin())
</script>

<window lang="html">
<div class="m-1">
    <h1 class="text-3xl font-bold">
        Upload then view the image
    </h1> 

    <p class="mt-4"></p>

    <input
        class="block w-full text-sm text-gray-900 border border-gray-300 cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
        id="file_input" type="file"
    >
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-300" id="file_input_help">
        PNG, JPG or TIFF.
    </p>

</div>
</window>
