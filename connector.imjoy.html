<config lang="json">
{
    "name": "connector",
    "type": "web-python",
    "tags": [],
    "flags": [],
    "ui": "",
    "version": "0.1.0",
    "cover": "",
    "description": "Connect to the bioengine server, and execute operations.",
    "icon": "extension",
    "inputs": null,
    "outputs": null,
    "api_version": "0.1.8",
    "env": "",
    "permissions": [],
    "requirements": [],
    "dependencies": []
}
</config>

<script lang="python">
import io
import imageio
from imjoy import api
from imjoy_rpc.hypha import connect_to_server


class Plugin():
    async def setup(self):
        api.log("Connector plugin is ready.")
        server = await connect_to_server(
            {"name": "client", "server_url": "https://ai.imjoy.io", "method_timeout": 30}
        )
        self.triton = await server.get_service("triton-client")

    async def bioengine_execute(self, model_id, inputs=None, return_rdf=False, weight_format=None):
        kwargs = {"model_id": model_id, "inputs": inputs, "return_rdf": return_rdf, "weight_format": weight_format}
        ret = await self.triton.execute(
            inputs=[kwargs],
            model_name="bioengine-model-runner",
            serialization="imjoy"
        )
        return ret["result"]

    async def get_model_rdf(self, model_id):
        ret = await self.bioengine_execute(model_id, return_rdf=True)
        return ret["rdf"]

    async def run(ctx):
        pass


api.export(Plugin())
</script>